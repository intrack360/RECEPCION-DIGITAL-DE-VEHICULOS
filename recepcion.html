<!-- ... Código anterior ... -->

    <div class="seccion">
      <h2>Firma Digital y Grabación</h2>
      <label>Firma del cliente:</label>
      <canvas id="canvasFirma" width="300" height="150" style="border:1px solid #ccc; display:block; margin-bottom:10px;"></canvas>
      <button type="button" onclick="borrarFirma()">Borrar Firma</button>

      <div style="margin-top:20px;">
        <label>Grabación de aceptación del cliente:</label><br>
        <button type="button" onclick="toggleGrabacion()" id="btnGrabar">🎤 Iniciar grabación</button>
        <audio id="audioReproduccion" controls style="display:none; margin-top:10px;"></audio>
      </div>
    </div>

    <div class="seccion">
      <h2>Confirmación Legal</h2>
      <div style="font-size: 0.85em; line-height: 1.6; background: #f1f1f1; border: 1px solid #ccc; padding: 10px; border-radius: 8px;">
        El presente documento ha sido firmado digitalmente por el cliente. Asimismo, se cuenta con una grabación de voz donde el cliente manifiesta su aceptación de los términos aquí establecidos. Tanto la firma como la grabación forman parte del expediente digital de esta recepción.
      </div>
    </div>

    <button type="submit">Guardar Recepción</button>
  </form>

  <audio id="bipSuccess" src="https://assets.mixkit.co/active_storage/sfx/1106/1106-preview.mp3"></audio>

  <script>
    // Firma digital
    const canvas = document.getElementById('canvasFirma');
    const ctx = canvas.getContext('2d');
    let firmando = false;
    canvas.addEventListener('mousedown', e => { firmando = true; ctx.moveTo(e.offsetX, e.offsetY); });
    canvas.addEventListener('mousemove', e => { if (firmando) { ctx.lineTo(e.offsetX, e.offsetY); ctx.stroke(); } });
    canvas.addEventListener('mouseup', () => firmando = false);
    canvas.addEventListener('mouseout', () => firmando = false);
    function borrarFirma() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Grabación de voz
    let grabando = false;
    let mediaRecorder;
    let chunks = [];
    async function toggleGrabacion() {
      const btn = document.getElementById('btnGrabar');
      if (!grabando) {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        chunks = [];
        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = () => {
          const blob = new Blob(chunks, { type: 'audio/mp3' });
          const url = URL.createObjectURL(blob);
          const audio = document.getElementById('audioReproduccion');
          audio.src = url;
          audio.style.display = 'block';
        };
        btn.textContent = '🛑 Detener grabación';
        grabando = true;
      } else {
        mediaRecorder.stop();
        btn.textContent = '🎤 Iniciar grabación';
        grabando = false;
      }
    }
  </script>
</body>
</html>
