<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recepción de Vehículo - Intrack360</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #1976d2;
    }
    .logo {
      text-align: right;
      margin-bottom: 10px;
    }
    .logo img {
      width: 100px;
    }
    .nombre-taller {
      text-align: center;
      font-size: 1.4rem;
      color: #1976d2;
      margin-bottom: 10px;
      font-weight: bold;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: auto;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 10px 20px;
      margin-top: 15px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #135ba1;
    }
    .small-text {
      text-align: center;
      font-size: 0.9rem;
      color: gray;
    }
    .preview-img {
      max-height: 100px;
      margin-top: 5px;
      display: block;
    }
  </style>
</head>
<body>

<div class="logo">
  <img src="https://github.com/intrack360/RECEPCION-DIGITAL-DE-VEHICULOS/blob/main/logo%20INTRACK%20360.png?raw=true" alt="Logo Intrack360" id="logoSistema">
</div>

<div class="nombre-taller" id="nombreTaller">Taller</div>

<h1>Recepción de vehículo para reparación automotriz</h1>

<div class="small-text" id="fechaHoy"></div>

<form id="formRecepcion">
  <label for="folioRecepcion">Folio de Recepción:</label>
  <input type="text" id="folioRecepcion" readonly>

  <h2>Datos del Cliente</h2>
  <input type="text" id="nombreCliente" placeholder="Nombre del Cliente" required>
  <input type="text" id="telefonoCliente" placeholder="Teléfono" required>
  <input type="text" id="poblacionCliente" placeholder="Población" required>

  <h2>Datos del Vehículo</h2>
  <input type="text" id="marcaVehiculo" placeholder="Marca" required>
  <input type="text" id="modeloVehiculo" placeholder="Modelo" required>
  <input type="text" id="anioVehiculo" placeholder="Año" required>
  <input type="text" id="motorVehiculo" placeholder="Motor" required>
  <input type="text" id="cilindradaVehiculo" placeholder="Cilindrada" required>
  <input type="text" id="placasVehiculo" placeholder="Placas" required>

  <h2>Evidencias Fotográficas</h2>

  <label>Foto Frente:</label>
  <input type="file" accept="image/*" id="fotoFrente" capture="environment">
  <img id="prevFotoFrente" class="preview-img" style="display:none;">

  <label>Foto Trasera:</label>
  <input type="file" accept="image/*" id="fotoTrasera" capture="environment">
  <img id="prevFotoTrasera" class="preview-img" style="display:none;">

  <label>Foto Lado Derecho:</label>
  <input type="file" accept="image/*" id="fotoDerecho" capture="environment">
  <img id="prevFotoDerecho" class="preview-img" style="display:none;">

  <label>Foto Lado Izquierdo:</label>
  <input type="file" accept="image/*" id="fotoIzquierdo" capture="environment">
  <img id="prevFotoIzquierdo" class="preview-img" style="display:none;">

  <label>Foto Llaves del Vehículo:</label>
  <input type="file" accept="image/*" id="fotoLlaves" capture="environment">
  <img id="prevFotoLlaves" class="preview-img" style="display:none;">

  <label>Foto Batería del Vehículo:</label>
  <input type="file" accept="image/*" id="fotoBateria" capture="environment">
  <img id="prevFotoBateria" class="preview-img" style="display:none;">

  <h2>Video de Vehículo (máx. 2 min)</h2>
  <input type="file" accept="video/*" id="videoVehiculo" capture="environment">

  <h2>Condiciones Generales (Cláusulas)</h2>
  <textarea id="clausulasLegales" rows="8" readonly></textarea>

  <button type="submit" id="guardarBtn">Guardar Recepción</button>
</form>

<audio id="audioSuccess" src="https://assets.mixkit.co/active_storage/sfx/625/625-preview.mp3"></audio>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const fecha = new Date().toLocaleDateString('es-MX', { year: 'numeric', month: 'long', day: 'numeric' });
    document.getElementById('fechaHoy').textContent = "Fecha: " + fecha;

    const config = JSON.parse(localStorage.getItem('configuracionTaller'));
    if (config) {
      document.getElementById('nombreTaller').textContent = config.nombreTaller;
      document.getElementById('logoSistema').src = config.logo;
      document.getElementById('clausulasLegales').value = config.clausulas;
    } else {
      document.getElementById('nombreTaller').textContent = "Taller Automotriz";
      document.getElementById('clausulasLegales').value = "No nos responsabilizamos por la integridad de piezas plásticas resecas, deterioradas o quebradizas del motor que puedan deshacerse al manipularse.";
    }

    generarFolio();
  });

  function generarFolio() {
    let ultimoFolio = localStorage.getItem('ultimoFolio');
    if (!ultimoFolio) {
      ultimoFolio = 1;
    } else {
      ultimoFolio = parseInt(ultimoFolio) + 1;
    }
    localStorage.setItem('ultimoFolio', ultimoFolio);
    document.getElementById('folioRecepcion').value = "INTR-" + String(ultimoFolio).padStart(3, '0');
  }

  function previsualizar(inputId, imgId) {
    const input = document.getElementById(inputId);
    const img = document.getElementById(imgId);
    input.addEventListener('change', function() {
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          img.src = e.target.result;
          img.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });
  }

  previsualizar('fotoFrente', 'prevFotoFrente');
  previsualizar('fotoTrasera', 'prevFotoTrasera');
  previsualizar('fotoDerecho', 'prevFotoDerecho');
  previsualizar('fotoIzquierdo', 'prevFotoIzquierdo');
  previsualizar('fotoLlaves', 'prevFotoLlaves');
  previsualizar('fotoBateria', 'prevFotoBateria');

  document.getElementById('formRecepcion').addEventListener('submit', function(event) {
    event.preventDefault();

    // Validar que haya fotos
    const fotos = ['fotoFrente','fotoTrasera','fotoDerecho','fotoIzquierdo','fotoLlaves','fotoBateria'];
    for (let id of fotos) {
      if (!document.getElementById(id).files.length) {
        alert('⚠️ Debes subir todas las evidencias fotográficas.');
        return;
      }
    }
    if (!document.getElementById('videoVehiculo').files.length) {
      alert('⚠️ Debes subir el video del vehículo.');
      return;
    }

    // Todo correcto
    document.getElementById('audioSuccess').play();
    alert('✅ Recepción guardada correctamente.');

    // Reiniciar todo
    this.reset();
    generarFolio();
    document.querySelectorAll('.preview-img').forEach(img => img.style.display = 'none');
    const fecha = new Date().toLocaleDateString('es-MX', { year: 'numeric', month: 'long', day: 'numeric' });
    document.getElementById('fechaHoy').textContent = "Fecha: " + fecha;
    document.getElementById('clausulasLegales').value = JSON.parse(localStorage.getItem('configuracionTaller'))?.clausulas || "No nos responsabilizamos por la integridad de piezas plásticas resecas, deterioradas o quebradizas del motor que puedan deshacerse al manipularse.";
  });
</script>

</body>
</html>
